{"version":3,"file":"_server.ts-D7Xin6zZ.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/slots/toggle_responsible/_server.ts.js"],"sourcesContent":["import { p as prisma } from \"../../../../../chunks/prisma.js\";\nconst POST = async (event) => {\n  const { user_id, slot_id } = await event.request.json();\n  const sessionUser = event.locals.user;\n  const dbUser = await prisma.user.findUnique({ where: { id: sessionUser?.id } });\n  const slot = await prisma.slot.findUnique({ where: { id: slot_id }, include: { responsibles: true } });\n  if (!slot) {\n    return new Response(JSON.stringify({ error: \"Slot not found\" }), { status: 404 });\n  }\n  const isResponsible = !!slot.responsibles.find((r) => r.id === dbUser?.id);\n  const can_manage = !!dbUser?.root || isResponsible;\n  if (!can_manage) {\n    return new Response(JSON.stringify(\"Insufficient permissions\"), { status: 403 });\n  }\n  const target = await prisma.user.findUnique({ where: { id: user_id }, include: { slots: true } });\n  const isParticipant = !!target?.slots.find((s) => s.id === slot_id);\n  if (!target?.instructor || !isParticipant) {\n    return new Response(JSON.stringify(\"Target must be an instructor and participant\"), { status: 400 });\n  }\n  const alreadyResponsible = !!slot.responsibles.find((r) => r.id === user_id);\n  try {\n    await prisma.slot.update({\n      where: { id: slot_id },\n      data: {\n        responsibles: alreadyResponsible ? { disconnect: { id: user_id } } : { connect: { id: user_id } }\n      }\n    });\n    const updated = await prisma.slot.findUnique({ where: { id: slot_id }, include: { responsibles: true } });\n    return new Response(JSON.stringify({ responsibles: updated?.responsibles ?? [] }), { status: 200 });\n  } catch (error) {\n    console.log(error);\n    return new Response(JSON.stringify(error), { status: 400 });\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}