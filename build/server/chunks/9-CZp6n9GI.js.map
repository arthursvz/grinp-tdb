{"version":3,"file":"9-CZp6n9GI.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(app)/register/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/9.js"],"sourcesContent":["import { z as zod, d as registerScheme } from \"../../../../chunks/zod.js\";\nimport { l as lucia } from \"../../../../chunks/lucia.js\";\nimport { p as prisma } from \"../../../../chunks/prisma.js\";\nimport { r as redirect, f as fail } from \"../../../../chunks/index.js\";\nimport * as argon2 from \"argon2\";\nimport \"../../../../chunks/stores.js\";\nimport \"just-clone\";\nimport \"ts-deepmerge\";\nimport { s as superValidate } from \"../../../../chunks/superValidate.js\";\nimport \"memoize-weak\";\nimport \"@exodus/schemasafe\";\nconst load = async (event) => {\n  if (event.locals.user) {\n    redirect(302, \"/\");\n  }\n  return {\n    form: await superValidate(zod(registerScheme))\n  };\n};\nconst actions = {\n  manual: async (event) => {\n    const form = await superValidate(event, zod(registerScheme));\n    if (!form.valid) {\n      return fail(400, { form });\n    } else {\n      try {\n        const existsClassicUser = await prisma.user.findUnique({\n          where: {\n            email: form.data.email\n          }\n        }).then((u) => u ? true : false).catch(() => false);\n        let user;\n        const hash = await argon2.hash(form.data.password);\n        if (existsClassicUser) {\n          user = await prisma.user.update({\n            where: {\n              email: form.data.email\n            },\n            data: {\n              password: hash\n            }\n          });\n        } else {\n          user = await prisma.user.create({\n            data: {\n              //id: \"0\",\n              first_name: form.data.first_name,\n              last_name: form.data.last_name,\n              email: form.data.email,\n              password: hash\n            }\n          });\n        }\n        try {\n          const session = await lucia.createSession(user.id, {\n            userId: user.id,\n            expiresAt: new Date(Date.now() + 1e3 * 60 * 60 * 24 * 15)\n            // 15 days\n          });\n          const sessionCookie = lucia.createSessionCookie(session.id);\n          event.cookies.set(sessionCookie.name, sessionCookie.value, {\n            path: \"/\",\n            ...sessionCookie.attributes\n          });\n        } catch (error) {\n          console.log(error);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n      throw redirect(302, \"/\");\n    }\n  },\n  oauth: async () => {\n    throw redirect(302, \"/login\");\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(app)/register/_page.server.ts.js';\n\nexport const index = 9;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(app)/register/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(app)/register/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/9.BaeE2IcH.js\",\"_app/immutable/chunks/scheduler.C7Wo8M4i.js\",\"_app/immutable/chunks/index.CV8hfPSa.js\",\"_app/immutable/chunks/utils.9a4hcQZ0.js\",\"_app/immutable/chunks/card.CE70MUHO.js\",\"_app/immutable/chunks/card-content.BtYrswVR.js\",\"_app/immutable/chunks/card-description.aHE51XGI.js\",\"_app/immutable/chunks/index.Cej-GNJg.js\",\"_app/immutable/chunks/button.LSeDBL-G.js\",\"_app/immutable/chunks/index._5LYSXs0.js\",\"_app/immutable/chunks/input.aOOZU8Wk.js\",\"_app/immutable/chunks/each.DxDIO64g.js\",\"_app/immutable/chunks/stores.2WuGYSmf.js\",\"_app/immutable/chunks/entry.CEfYAMar.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAWA,MAAM,IAAI,GAAG,OAAO,KAAK,KAAK;AAC9B,EAAE,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE;AACzB,IAAI,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AACvB,GAAG;AACH,EAAE,OAAO;AACT,IAAI,IAAI,EAAE,MAAM,aAAa,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;AAClD,GAAG,CAAC;AACJ,CAAC,CAAC;AACF,MAAM,OAAO,GAAG;AAChB,EAAE,MAAM,EAAE,OAAO,KAAK,KAAK;AAC3B,IAAI,MAAM,IAAI,GAAG,MAAM,aAAa,CAAC,KAAK,EAAE,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;AACjE,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE;AACrB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,IAAI,EAAE,CAAC,CAAC;AACjC,KAAK,MAAM;AACX,MAAM,IAAI;AACV,QAAQ,MAAM,iBAAiB,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;AAC/D,UAAU,KAAK,EAAE;AACjB,YAAY,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK;AAClC,WAAW;AACX,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,IAAI,GAAG,KAAK,CAAC,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,CAAC;AAC5D,QAAQ,IAAI,IAAI,CAAC;AACjB,QAAQ,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC3D,QAAQ,IAAI,iBAAiB,EAAE;AAC/B,UAAU,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;AAC1C,YAAY,KAAK,EAAE;AACnB,cAAc,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK;AACpC,aAAa;AACb,YAAY,IAAI,EAAE;AAClB,cAAc,QAAQ,EAAE,IAAI;AAC5B,aAAa;AACb,WAAW,CAAC,CAAC;AACb,SAAS,MAAM;AACf,UAAU,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;AAC1C,YAAY,IAAI,EAAE;AAClB;AACA,cAAc,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU;AAC9C,cAAc,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS;AAC5C,cAAc,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK;AACpC,cAAc,QAAQ,EAAE,IAAI;AAC5B,aAAa;AACb,WAAW,CAAC,CAAC;AACb,SAAS;AACT,QAAQ,IAAI;AACZ,UAAU,MAAM,OAAO,GAAG,MAAM,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,EAAE;AAC7D,YAAY,MAAM,EAAE,IAAI,CAAC,EAAE;AAC3B,YAAY,SAAS,EAAE,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;AACrE;AACA,WAAW,CAAC,CAAC;AACb,UAAU,MAAM,aAAa,GAAG,KAAK,CAAC,mBAAmB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;AACtE,UAAU,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,EAAE,aAAa,CAAC,KAAK,EAAE;AACrE,YAAY,IAAI,EAAE,GAAG;AACrB,YAAY,GAAG,aAAa,CAAC,UAAU;AACvC,WAAW,CAAC,CAAC;AACb,SAAS,CAAC,OAAO,KAAK,EAAE;AACxB,UAAU,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAC7B,SAAS;AACT,OAAO,CAAC,OAAO,KAAK,EAAE;AACtB,QAAQ,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAC3B,OAAO;AACP,MAAM,MAAM,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAC/B,KAAK;AACL,GAAG;AACH,EAAE,KAAK,EAAE,YAAY;AACrB,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AAClC,GAAG;AACH,CAAC;;;;;;;;AC1EW,MAAC,KAAK,GAAG,EAAE;AACvB,IAAI,eAAe,CAAC;AACR,MAAC,SAAS,GAAG,YAAY,eAAe,KAAK,CAAC,MAAM,OAAO,4BAAiD,CAAC,EAAE,QAAQ;AAEvH,MAAC,SAAS,GAAG,4CAA4C;AACzD,MAAC,OAAO,GAAG,CAAC,oCAAoC,CAAC,6CAA6C,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,wCAAwC,CAAC,gDAAgD,CAAC,oDAAoD,CAAC,yCAAyC,CAAC,0CAA0C,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,wCAAwC,CAAC,0CAA0C,CAAC,yCAAyC,EAAE;AAC1mB,MAAC,WAAW,GAAG,GAAG;AAClB,MAAC,KAAK,GAAG;;;;"}