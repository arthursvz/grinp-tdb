var mt=Object.defineProperty;var _t=(r,t,e)=>t in r?mt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var a=(r,t,e)=>_t(r,typeof t!="symbol"?t+"":t,e);import{d as p,r as I,w as E}from"./index._5LYSXs0.js";import"./index.CV8hfPSa.js";const Ft=r=>{const t=Object.entries(r),e=t.map(([s])=>s);return p(t.map(([,s])=>s),s=>Object.fromEntries(s.map((n,o)=>[e[o],n])))},qt=r=>(r==null?void 0:r.subscribe)instanceof Function,Lt=I(void 0);class X{constructor({header:t,footer:e,height:s,plugins:n}){a(this,"header");a(this,"footer");a(this,"height");a(this,"plugins");this.header=t,this.footer=e,this.height=s,this.plugins=n}isFlat(){return"__flat"in this}isData(){return"__data"in this}isDisplay(){return"__display"in this}isGroup(){return"__group"in this}}class Y extends X{constructor({header:e,footer:s,plugins:n,id:o}){super({header:e,footer:s,plugins:n,height:1});a(this,"__flat",!0);a(this,"id");this.id=o??String(e)}}class Ct extends Y{constructor({header:e,footer:s,plugins:n,cell:o,accessor:l,id:c}){super({header:e,footer:s,plugins:n,id:"Initialization not complete"});a(this,"__data",!0);a(this,"cell");a(this,"accessorKey");a(this,"accessorFn");if(this.cell=o,l instanceof Function?this.accessorFn=l:this.accessorKey=l,c===void 0&&this.accessorKey===void 0&&e===void 0)throw new Error("A column id, string accessor, or header is required");const d=typeof this.accessorKey=="string"?this.accessorKey:null;this.id=c??d??String(e)}getValue(e){if(this.accessorFn!==void 0)return this.accessorFn(e);if(this.accessorKey!==void 0)return e[this.accessorKey]}}class Et extends Y{constructor({header:e,footer:s,plugins:n,id:o,cell:l,data:c}){super({header:e,footer:s,plugins:n,id:o});a(this,"__display",!0);a(this,"cell");a(this,"data");this.cell=l,this.data=c}}class Rt extends X{constructor({header:e,footer:s,columns:n,plugins:o}){const l=Math.max(...n.map(c=>c.height))+1;super({header:e,footer:s,height:l,plugins:o});a(this,"__group",!0);a(this,"columns");a(this,"ids");this.columns=n,this.ids=tt(n)}}const tt=r=>r.flatMap(t=>t.isFlat()?[t.id]:t.isGroup()?t.ids:[]),et=r=>r.flatMap(t=>t.isFlat()?[t]:t.isGroup()?et(t.columns):[]),jt=r=>{const t=new Map;return r.forEach(e=>{t.set(e,(t.get(e)??0)+1)}),t},At=r=>Array.from(jt(r).entries()).filter(([,t])=>t!==1).map(([t])=>t),vt=r=>Object.entries(r).map(([t,e])=>`${t}:${e}`).join(";"),St=(r,t)=>r.style===void 0&&t.style===void 0?{...r,...t}:{...r,...t,style:{...typeof r.style=="object"?r.style:{},...typeof t.style=="object"?t.style:{}}},x=r=>r.style===void 0||typeof r.style!="object"?r:{...r,style:vt(r.style)};class P{constructor({id:t}){a(this,"id");a(this,"attrsForName",{});a(this,"propsForName",{});a(this,"state");this.id=t}attrs(){return p(Object.values(this.attrsForName),t=>{let e={};return t.forEach(s=>{e=St(e,s)}),x(e)})}props(){return Ft(this.propsForName)}injectState(t){this.state=t}applyHook(t,e){e.props!==void 0&&(this.propsForName[t]=e.props),e.attrs!==void 0&&(this.attrsForName[t]=e.attrs)}}class st extends P{constructor({id:e,row:s}){super({id:e});a(this,"row");this.row=s}attrs(){return p(super.attrs(),e=>({...e,role:"cell"}))}rowColId(){return`${this.row.id}:${this.column.id}`}dataRowColId(){if(this.row.isData())return`${this.row.dataId}:${this.column.id}`}isData(){return"__data"in this}isDisplay(){return"__display"in this}}class N extends st{constructor({row:e,column:s,label:n,value:o}){super({id:s.id,row:e});a(this,"__data",!0);a(this,"column");a(this,"label");a(this,"value");this.column=s,this.label=n,this.value=o}render(){if(this.label===void 0)return`${this.value}`;if(this.state===void 0)throw new Error("Missing `state` reference");return this.label(this,this.state)}clone(){return new N({row:this.row,column:this.column,label:this.label,value:this.value})}}class U extends st{constructor({row:e,column:s,label:n}){super({id:s.id,row:e});a(this,"__display",!0);a(this,"column");a(this,"label");this.column=s,this.label=n}render(){if(this.state===void 0)throw new Error("Missing `state` reference");return this.label(this,this.state)}clone(){return new U({row:this.row,column:this.column,label:this.label})}}const A=r=>r!==void 0;class It extends P{constructor({id:e,cells:s,cellForId:n,depth:o=0,parentRow:l}){super({id:e});a(this,"cells");a(this,"cellForId");a(this,"depth");a(this,"parentRow");a(this,"subRows");this.cells=s,this.cellForId=n,this.depth=o,this.parentRow=l}attrs(){return p(super.attrs(),e=>({...e,role:"row"}))}isData(){return"__data"in this}isDisplay(){return"__display"in this}}class V extends It{constructor({id:e,dataId:s,original:n,cells:o,cellForId:l,depth:c=0,parentRow:d}){super({id:e,cells:o,cellForId:l,depth:c,parentRow:d});a(this,"__data",!0);a(this,"dataId");a(this,"original");this.dataId=s,this.original=n}clone({includeCells:e=!1,includeSubRows:s=!1}={}){var o;const n=new V({id:this.id,dataId:this.dataId,cellForId:this.cellForId,cells:this.cells,original:this.original,depth:this.depth});if(e){const l=Object.fromEntries(Object.entries(n.cellForId).map(([d,m])=>{const g=m.clone();return g.row=n,[d,g]})),c=n.cells.map(({id:d})=>l[d]);n.cellForId=l,n.cells=c}if(s){const l=(o=this.subRows)==null?void 0:o.map(c=>c.clone({includeCells:e,includeSubRows:s}));n.subRows=l}else n.subRows=this.subRows;return n}}const Ht=(r,t,{rowDataId:e}={})=>{const s=r.map((n,o)=>{const l=o.toString();return new V({id:l,dataId:e!==void 0?e(n,o):l,original:n,cells:[],cellForId:{}})});return r.forEach((n,o)=>{const l=t.map(c=>{if(c.isData()){const d=c,m=d.getValue(n);return new N({row:s[o],column:d,label:c.cell,value:m})}if(c.isDisplay()){const d=c;return new U({row:s[o],column:d,label:c.cell})}throw new Error("Unrecognized `FlatColumn` implementation")});s[o].cells=l,t.forEach((c,d)=>{s[o].cellForId[c.id]=l[d]})}),s},xt=(r,t)=>{const e=r.map(s=>{const n=s.clone();return n.cells=[],n.cellForId={},n});return r.length===0||t.length===0?r:(r.forEach((s,n)=>{const o=s.cells.map(c=>{const d=c.clone();return d.row=e[n],d}),l=t.map(c=>o.find(d=>d.id===c)).filter(A);e[n].cells=l,o.forEach(c=>{e[n].cellForId[c.id]=c})}),e)},rt=" ";class nt extends P{constructor({id:e,label:s,colspan:n,colstart:o}){super({id:e});a(this,"label");a(this,"colspan");a(this,"colstart");this.label=s,this.colspan=n,this.colstart=o}render(){if(this.label instanceof Function){if(this.state===void 0)throw new Error("Missing `state` reference");return this.label(this,this.state)}return this.label}attrs(){return p(super.attrs(),e=>({...e,role:"columnheader",colspan:this.colspan}))}isFlat(){return"__flat"in this}isData(){return"__data"in this}isFlatDisplay(){return"__flat"in this&&"__display"in this}isGroup(){return"__group"in this}isGroupDisplay(){return"__group"in this&&"__display"in this}}class k extends nt{constructor({id:e,label:s,colstart:n}){super({id:e,label:s,colspan:1,colstart:n});a(this,"__flat",!0)}clone(){return new k({id:this.id,label:this.label,colstart:this.colstart})}}class q extends k{constructor({id:e,label:s,accessorKey:n,accessorFn:o,colstart:l}){super({id:e,label:s,colstart:l});a(this,"__data",!0);a(this,"accessorKey");a(this,"accessorFn");this.accessorKey=n,this.accessorFn=o}clone(){return new q({id:this.id,label:this.label,accessorFn:this.accessorFn,accessorKey:this.accessorKey,colstart:this.colstart})}}class D extends k{constructor({id:e,label:s=rt,colstart:n}){super({id:e,label:s,colstart:n});a(this,"__display",!0)}clone(){return new D({id:this.id,label:this.label,colstart:this.colstart})}}class M extends nt{constructor({label:e,ids:s,allIds:n,colspan:o,colstart:l}){super({id:`[${s.join(",")}]`,label:e,colspan:o,colstart:l});a(this,"__group",!0);a(this,"ids");a(this,"allId");a(this,"allIds");this.ids=s,this.allId=`[${n.join(",")}]`,this.allIds=n}setIds(e){this.ids=e,this.id=`[${this.ids.join(",")}]`}pushId(e){this.ids=[...this.ids,e],this.id=`[${this.ids.join(",")}]`}clone(){return new M({label:this.label,ids:this.ids,allIds:this.allIds,colspan:this.colspan,colstart:this.colstart})}}class L extends M{constructor({label:e=rt,ids:s,allIds:n,colspan:o=1,colstart:l}){super({label:e,ids:s,allIds:n,colspan:o,colstart:l});a(this,"__display",!0)}clone(){return new L({label:this.label,ids:this.ids,allIds:this.allIds,colspan:this.colspan,colstart:this.colstart})}}const Pt=r=>r.reduce((t,e)=>t+e,0),ot=(r,t)=>{const e=[];for(let s=0;s<t;s++)e.push(Array(r).fill(null));return e},W=r=>{const t=r.length;if(t===0)return r;const e=r[0].length,s=ot(t,e);for(let n=0;n<e;n++)for(let o=0;o<t;o++)s[n][o]=r[o][n];return s};class Z extends P{constructor({id:e,cells:s}){super({id:e});a(this,"cells");this.cells=s}attrs(){return p(super.attrs(),e=>({...e,role:"row"}))}clone(){return new Z({id:this.id,cells:this.cells})}}const kt=(r,t=[])=>{const e=Dt(r);let s=W(e);return s=Mt(s,t),Ot(s),Tt(W(s))},Dt=r=>{const t=Pt(r.map(o=>o.isGroup()?o.ids.length:1)),e=Math.max(...r.map(o=>o.height)),s=ot(t,e);let n=0;return r.forEach(o=>{const l=e-o.height;it(s,o,l,n),n+=o.isGroup()?o.ids.length:1}),s.map((o,l)=>o.map((c,d)=>{var g;if(c!==null)return c;if(l===e-1)return new D({id:d.toString(),colstart:d});const m=((g=s[e-1][d])==null?void 0:g.id)??d.toString();return new L({ids:[],allIds:[m],colstart:d})}))},it=(r,t,e,s)=>{if(t.isData()){r[r.length-1][s]=new q({label:t.header,accessorFn:t.accessorFn,accessorKey:t.accessorKey,id:t.id,colstart:s});return}if(t.isDisplay()){r[r.length-1][s]=new D({id:t.id,label:t.header,colstart:s});return}if(t.isGroup()){for(let o=0;o<t.ids.length;o++)r[e][s+o]=new M({label:t.header,colspan:1,allIds:t.ids,ids:[],colstart:s});let n=0;t.columns.forEach(o=>{it(r,o,e+1,s+n),n+=o.isGroup()?o.ids.length:1});return}},Mt=(r,t)=>{if(t.length===0)return r;const e=[];return t.forEach((s,n)=>{const o=r.find(l=>{const c=l[l.length-1];if(!c.isFlat())throw new Error("The last element of each column must be a `FlatHeaderCell`");return c.id===s});o!==void 0&&e.push(o.map(l=>{const c=l.clone();return c.colstart=n,c}))}),e},Ot=r=>{r.forEach(t=>{const e=t[t.length-1];if(!e.isFlat())throw new Error("The last element of each column must be a `FlatHeaderCell`");t.forEach(s=>{s.isGroup()&&s.pushId(e.id)})})},Tt=r=>r.map((t,e)=>new Z({id:e.toString(),cells:Gt(t)})),Gt=r=>{if(r.length===0)return r;const t=[];let e=0,s=1;for(;e<r.length;){const n=r[e].clone();if(!n.isGroup()){t.push(n),e++;continue}s=e+1;const o=[...n.ids];for(;s<r.length;){const l=r[s];if(!l.isGroup()||n.allId!==l.allId)break;o.push(...l.ids),s++}n.setIds(o),n.colspan=s-e,t.push(n),e=s}return t},Kt=(r,t,{rowDataId:e}={})=>{const{data:s,plugins:n}=r,o=et(t),l=I(o),c=p([s,l],([i,u])=>Ht(i,u,{rowDataId:e})),d=E([]),m=E(),g=E([]),v=E([]),S=E({role:"table"}),f=E({}),w=E({role:"rowgroup"}),F={data:s,columns:t,flatColumns:o,tableAttrs:S,tableHeadAttrs:f,tableBodyAttrs:w,visibleColumns:d,headerRows:m,originalRows:c,rows:g,pageRows:v},y=Object.fromEntries(Object.entries(n).map(([i,u])=>{const h=Object.fromEntries(o.map(b=>{var C;const _=(C=b.plugins)==null?void 0:C[i];if(_!==void 0)return[b.id,_]}).filter(A));return[i,u({pluginName:i,tableState:F,columnOptions:h})]})),H=Object.fromEntries(Object.entries(y).map(([i,u])=>[i,u.pluginState])),R={data:s,columns:t,flatColumns:o,tableAttrs:S,tableHeadAttrs:f,tableBodyAttrs:w,visibleColumns:d,headerRows:m,originalRows:c,rows:g,pageRows:v,pluginStates:H},at=Object.values(y).map(i=>i.deriveTableAttrs).filter(A);let O=I({role:"table"});at.forEach(i=>{O=i(O)});const lt=p(O,i=>{const u=x(i);return S.set(u),u}),ct=Object.values(y).map(i=>i.deriveTableBodyAttrs).filter(A);let T=I({});ct.forEach(i=>{T=i(T)});const dt=p(T,i=>{const u=x(i);return f.set(u),u}),ut=Object.values(y).map(i=>i.deriveTableBodyAttrs).filter(A);let G=I({role:"rowgroup"});ut.forEach(i=>{G=i(G)});const ht=p(G,i=>{const u=x(i);return w.set(u),u}),pt=Object.values(y).map(i=>i.deriveFlatColumns).filter(A);let K=l;pt.forEach(i=>{K=i(K)});const z=p(K,i=>(d.set(i),i)),ft=p([c,z],([i,u])=>xt(i,u.map(h=>h.id))),bt=Object.values(y).map(i=>i.deriveRows).filter(A);let B=ft;bt.forEach(i=>{B=i(B)});const J=p(B,i=>(i.forEach(u=>{u.injectState(R),u.cells.forEach(h=>{h.injectState(R)})}),Object.entries(y).forEach(([u,h])=>{i.forEach(b=>{var _;((_=h.hooks)==null?void 0:_["tbody.tr"])!==void 0&&b.applyHook(u,h.hooks["tbody.tr"](b)),b.cells.forEach(C=>{var j;((j=h.hooks)==null?void 0:j["tbody.tr.td"])!==void 0&&C.applyHook(u,h.hooks["tbody.tr.td"](C))})})}),g.set(i),i)),gt=Object.values(y).map(i=>i.derivePageRows).filter(A);let $=J;gt.forEach(i=>{$=i($)});const wt=p($,i=>(i.forEach(u=>{u.injectState(R),u.cells.forEach(h=>{h.injectState(R)})}),Object.entries(y).forEach(([u,h])=>{i.forEach(b=>{var _;((_=h.hooks)==null?void 0:_["tbody.tr"])!==void 0&&b.applyHook(u,h.hooks["tbody.tr"](b)),b.cells.forEach(C=>{var j;((j=h.hooks)==null?void 0:j["tbody.tr.td"])!==void 0&&C.applyHook(u,h.hooks["tbody.tr.td"](C))})})}),v.set(i),i)),yt=p(z,i=>{const u=kt(t,i.map(h=>h.id));return u.forEach(h=>{h.injectState(R),h.cells.forEach(b=>{b.injectState(R)})}),Object.entries(y).forEach(([h,b])=>{u.forEach(_=>{var C;((C=b.hooks)==null?void 0:C["thead.tr"])!==void 0&&_.applyHook(h,b.hooks["thead.tr"](_)),_.cells.forEach(j=>{var Q;((Q=b.hooks)==null?void 0:Q["thead.tr.th"])!==void 0&&j.applyHook(h,b.hooks["thead.tr.th"](j))})})}),m.set(u),u});return{tableAttrs:lt,tableHeadAttrs:dt,tableBodyAttrs:ht,visibleColumns:z,flatColumns:o,headerRows:yt,originalRows:c,rows:J,pageRows:wt,pluginStates:H}};class zt{constructor(t,e){a(this,"data");a(this,"plugins");this.data=t,this.plugins=e}createColumns(t){const e=tt(t),s=At(e);if(s.length!==0)throw new Error(`Duplicate column ids not allowed: "${s.join('", "')}"`);return t}column(t){return new Ct(t)}group(t){return new Rt(t)}display(t){return new Et(t)}createViewModel(t,e){return Kt(this,t,e)}}const Zt=(r,t={})=>new zt(r,t);I(void 0);const Bt=1,$t=({items:r,initialPageSize:t,initialPageIndex:e,serverSide:s,serverItemCount:n})=>{const o=E(t),l=f=>{o.update(w=>{const F=f(w);return Math.max(F,Bt)})},c=f=>l(()=>f),d=E(e);function m([f,w]){const F=Math.ceil(w/f);return d.update(y=>F>0&&y>=F?F-1:y),F}let g;if(s&&n!=null)g=p([o,n],m);else{const f=p(r,w=>w.length);g=p([o,f],m)}const v=p(d,f=>f>0),S=p([d,g],([f,w])=>f<w-1);return{pageSize:{subscribe:o.subscribe,update:l,set:c},pageIndex:d,pageCount:g,serverItemCount:n,hasPreviousPage:v,hasNextPage:S}},Jt=({initialPageIndex:r=0,initialPageSize:t=10,serverSide:e=!1,serverItemCount:s}={})=>()=>{const n=E([]),o=E([]),{pageSize:l,pageIndex:c,pageCount:d,hasPreviousPage:m,hasNextPage:g}=$t({items:n,initialPageIndex:r,initialPageSize:t,serverSide:e,serverItemCount:s});return{pluginState:{pageSize:l,pageIndex:c,pageCount:d,hasPreviousPage:m,hasNextPage:g},derivePageRows:f=>p([f,l,c],([w,F,y])=>{if(n.set(w),e)return o.set(w),w;const H=y*F,R=w.slice(H,H+F);return o.set(R),R})}};export{Lt as U,Jt as a,Zt as c,Ft as d,qt as i};
