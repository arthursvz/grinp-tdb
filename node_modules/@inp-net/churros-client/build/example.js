import express from 'express';
import { ChurrosClient } from './index';
const churros = new ChurrosClient({
    client_id: 'y1uiqnjgyblq6wl9',
    client_secret: 'dFTCyanz7-OfGdMXt3zH-X8_Hn80X9',
    // where you want to redirect the user after login
    redirect_uri: 'http://localhost:3000/callback',
});
const yourApp = express();
yourApp.get('/login', (_, res) => {
    res.redirect(churros.authorizationURL);
});
yourApp.get(churros.redirectURL.pathname, async (req, res) => {
    if (req.query['error']) {
        // Handle error
        res.sendStatus(500);
    }
    const token = await churros.getToken(req.query['code'], req.query['state']);
    // Do something with the token, for example get some user info,
    // or use the GraphQL API for everything else (see https://churros.inpt.fr/graphql in your browser)
    const userInfo = await fetch('https://churros.inpt.fr/identity', {
        headers: {
            Authorization: `Bearer ${token}`,
        },
    });
    res.status(200).json(await userInfo.json());
});
console.info('Listening on http://localhost:3000');
yourApp.listen(3000);
